
<%if @message  %>
<%= flash[:alert] = @message %> 
<%end%>
<%= stylesheet_link_tag 'likes', media: 'all'%>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />

<%if !@products || @products.length == 0 %>
  <%= flash[:alert] = "Sorry we couldn't find the product you were looking for" %>
  <% @products =Product.all %>
<%end%>

<% if current_user %>
  <%@products = current_user.feed(@products)%>
<%end%>

<% @products.each_slice(3)  do |products| %>
  <div class="row "id="allpro" >
    <% products.each do |product| %> 
      <div class="col-md-4 " id="c" >
        <div class="card" >
          <% if product.images.present? %>
            <%= image_tag(product.images.first, class:"card-img-top")%> 
          <% else %>
            <%= image_tag( '/loginImage.jpg', class:"card-img-top") %> 
          <% end %>
          <div class="card-body" >
            <h5 class="card-title">
              <div class ="col-md-6 nopadding" >
                <%= product.name %>
              </div>
              <%if current_user &&  product.user == current_user %>
                <div class ="col-md-6 nopadding" >
                  <span  style="float:right"> @you </span>
                </div>
              <%else %>
                <div class ="col-md-6 nopadding" id="lik">
                  <%= link_to "@#{(User.find(product.user_id)).username}", user_path(product.user_id) if User.where(id: product.user_id)!= [] %>
                </div>
              <% end %>
            </h5> 
            <div class ="col-md-6 nopadding">
            </div> 
            <br>              
            <div style="float:right;text-align:right;width: 50%; display: inline-block;"> $<%= number_with_precision(product.price, :precision => 2)%> </div>
            <br>
            <% if current_user%>
              <div class ="col-md-6 nopadding"  >
                <div class ="liking" id="<%=product.id%>" >
                    <%= button_to raw("<i class=\"far fa-heart\"></i>"), product_like_path(product), params: {id: product.id }, id:"likebutton",onclick:"myFunction(this.id)" %>
                       
                    
                </div>
              </div>
              <div class ="col-md-12" style="text-align:left;">
                <p class="card-text"><%= link_to 'learn more', product_path(id: product.id ) %>    </p>
                <span style="margin-left:-1%;float:left;"> <%= button_to 'buy now', checkout_create_path,params: {id: product.id }, remote: true, class: "bottombutton" %></span>
                <div class="col-md-6 nopadding" id="lik" style="margin-right:-4%;margin-top:2%">
                  <%= link_to "Message", conversations_path(user_id: product.user_id, body: "I want to buy your product", subject: product.name ), method: 'post', class: 'btn btn-primary bottombutton' %>
                  <div class="padd"></div>
                </div> 
              </div> 
            <%end%>  
          </div> 
        </div>
      </div> 
    <% end %>   
  </div>
<% end %> 
            
              
 
<script>
function myFunction(id) {
  var like = document.getElementById(id);
//if the current first element is the white heart then the div will show the first element as a red heart and then products 
  var produ =  Product.find(id);
 if (like.innerHTML.child[0]=='<i class=\"far fa-heart\"></i>' ){
  like.innerHTML = <i style="color:red; background-color:red;"class="fas fa-heart"></i> ;
  }else {
    like.innerHTML = <i class="far fa-heart"></i> ;
  }

  
} 
</script>