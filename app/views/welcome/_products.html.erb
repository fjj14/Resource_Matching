<%if !@products || @products.length == 0 %>
<%= flash[:alert] = "Sorry we couldn't find the product you were looking for" %>
  <% @products =Product.all %>
<%end%>
<% @products.order('created_at DESC').each_slice(3)  do |products| %>
    <div class="row " >
     <% products.each do |product| %> 
      <div class="col-md-4 " >
            <div class="card">
                <h5 class="card-title">
                 <div class ="col-md-6 nopadding" >
                   <%= product.name %>
                   </div>
                   <div class ="col-md-6 nopadding" id="pri">
                    @<%= User.where(id: product.user_id).first.username %>
                   </div>
                 </h5>
                 <br>
                  <% if product.image.present? %>
                    <%= image_tag(product.image, class:"card-img-top")%> 
                  <% else %>
                    <%= image_tag( '/loginImage.jpg', class:"card-img-top") %> 
                  <% end %>
                <div class="card-body">
                <br>
                <div class ="col-md-6 nopadding">
                <%if session[:user_id] && product.user != current_user%>
                <%= link_to "Message", conversations_path(user_id: product.user_id, body: "I want to buy your product", subject: product.name ), method: 'post', class: 'btn btn-primary' %>
                 <% end %> 
                   </div>
                   <div class ="col-md-6 nopadding" id="pri">
                     $<%= number_with_precision(product.price, :precision => 2)%>
                   </div>
                   <br>
                   <div class ="col-md-12">
                    <p class="card-text"><%= product.description %></p>
                    </div>
                    <%= link_to "Purchase","https://venmo.com/#{product.user.venmo_id}?txn=pay&amount=#{product.price}", class: 'btn btn-primary' %>
                </div>
                
            </div>
        </div>
    <% end %>
    </div>
    <% end %>